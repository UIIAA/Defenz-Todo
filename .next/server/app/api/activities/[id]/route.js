(()=>{var e={};e.id=701,e.ids=[701],e.modules={1678:(e,t,r)=>{"use strict";r.d(t,{db:()=>s});let i=require("@prisma/client"),s=globalThis.prisma??new i.PrismaClient({log:["query"]})},2502:e=>{"use strict";e.exports=import("prettier/plugins/html")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4403:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{DELETE:()=>u,PUT:()=>p});var s=r(32190),a=r(1678),n=r(12909),o=r(30776),d=r(21111),c=r(41569),l=e([c]);async function u(e,{params:t}){try{let e=await (0,n.HW)();if(!e)return s.NextResponse.json({error:"Unauthorized"},{status:401});let r=await a.db.activity.findUnique({where:{id:t.id}});if(!r)return s.NextResponse.json({error:"Activity not found"},{status:404});return await a.db.activity.update({where:{id:t.id},data:{deletedAt:new Date}}),await (0,o.i)({action:"DELETE",entityType:"Activity",entityId:t.id,userId:e.id,userEmail:e.email,changes:{title:r.title,area:r.area,deletedAt:new Date().toISOString()}}),e.email&&(0,d.kX)({userId:e.id,emailType:"deleted",activityId:t.id,to:e.email,subject:`Atividade Deletada: ${r.title}`,react:(0,c.A)({activityTitle:r.title,area:r.area,oldStatus:"Em Andamento",newStatus:"Pendente",changedBy:e.name||e.email,activityUrl:`${process.env.NEXTAUTH_URL}/dashboard/activities`})},"activityDeleted").catch(e=>{console.error("Failed to send deletion email:",e)}),s.NextResponse.json({success:!0,message:"Activity deleted successfully"})}catch(e){return console.error("Delete activity error:",e),s.NextResponse.json({error:"Failed to delete activity"},{status:500})}}async function p(e,{params:t}){try{let r=await (0,n.HW)();if(!r)return s.NextResponse.json({error:"Unauthorized"},{status:401});let i=await e.json(),l=await a.db.activity.findUnique({where:{id:t.id}});if(!l)return s.NextResponse.json({error:"Activity not found"},{status:404});let u=await a.db.activity.update({where:{id:t.id},data:{title:i.title,area:i.area,priority:i.priority,status:i.status,description:i.description,responsible:i.responsible,deadline:i.deadline,location:i.location,how:i.how,cost:i.cost}});if(await (0,o.i)({action:"UPDATE",entityType:"Activity",entityId:t.id,userId:r.id,userEmail:r.email,changes:i}),l.status!==i.status&&r.email){let e=e=>{switch(e){case"pending":default:return"Pendente";case"in_progress":return"Em Andamento";case"completed":return"Conclu\xeddo"}};(0,d.kX)({userId:r.id,emailType:"status_change",activityId:u.id,to:r.email,subject:`Status Atualizado: ${u.title}`,react:(0,c.A)({activityTitle:u.title,area:u.area,oldStatus:e(l.status),newStatus:e(u.status),changedBy:r.name||r.email,activityUrl:`${process.env.NEXTAUTH_URL}/dashboard/activities`})},"statusChanged").catch(e=>{console.error("Failed to send status change email:",e)})}return s.NextResponse.json(u)}catch(e){return console.error("Update activity error:",e),s.NextResponse.json({error:"Failed to update activity"},{status:500})}}c=(l.then?(await l)():l)[0],i()}catch(e){i(e)}})},5792:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GET:()=>l,POST:()=>l,authOptions:()=>c});var i=r(19854),s=r.n(i),a=r(13581),n=r(60890),o=r(1678),d=r(85663);let c={adapter:(0,n.y)(o.db),providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password required");let t=await o.db.user.findUnique({where:{email:e.email}});if(!t||!t.password||!await d.Ay.compare(e.password,t.password))throw Error("Invalid credentials");return{id:t.id,email:t.email,name:t.name,role:t.role}}})],session:{strategy:"jwt"},pages:{signIn:"/",error:"/"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.role=t.role),e)},secret:process.env.NEXTAUTH_SECRET},l=s()(c)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12166:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{patchFetch:()=>c,routeModule:()=>l,serverHooks:()=>x,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>p});var s=r(96559),a=r(48088),n=r(37719),o=r(4403),d=e([o]);o=(d.then?(await d)():d)[0];let l=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/activities/[id]/route",pathname:"/api/activities/[id]",filename:"route",bundlePath:"app/api/activities/[id]/route"},resolvedPagePath:"/Users/marcoscruz/Documents/Projetos/Defenz/Defenz - To-Do/src/app/api/activities/[id]/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:u,workUnitAsyncStorage:p,serverHooks:x}=l;function c(){return(0,n.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:p})}i()}catch(e){i(e)}})},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,t,r)=>{"use strict";r.d(t,{HW:()=>n});var i=r(19854),s=r(5792);async function a(){return await (0,i.getServerSession)(s.authOptions)}async function n(){let e=await a();return e?.user}},21111:(e,t,r)=>{"use strict";r.d(t,{ZM:()=>d,kX:()=>c});var i=r(20549),s=r(1678);let a=process.env.RESEND_API_KEY?new i.u(process.env.RESEND_API_KEY):null;async function n(e){try{let t=await s.db.notificationPreferences.findUnique({where:{userId:e}});if(!t||!t.quietHoursStart||!t.quietHoursEnd)return!1;let r=new Date,i=`${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}`,a=t.quietHoursStart,n=t.quietHoursEnd;if(a>n)return i>=a||i<n;return i>=a&&i<n}catch(e){return console.error("Error checking quiet hours:",e),!1}}async function o(e,t){try{let r=await s.db.notificationPreferences.findUnique({where:{userId:e}});if(!r)return await s.db.notificationPreferences.create({data:{userId:e}}),!0;return r[t]}catch(e){return console.error("Error checking notification preferences:",e),!0}}async function d({userId:e,emailType:t,activityId:r,to:i,subject:n,react:o}){try{if(!a)return console.warn("RESEND_API_KEY not configured. Email sending disabled."),{success:!1,error:"Email service not configured"};let{data:d,error:c}=await a.emails.send({from:`${process.env.EMAIL_FROM_NAME||"Defenz To-Do"} <${process.env.EMAIL_FROM||"onboarding@resend.dev"}>`,to:[i],subject:n,react:o});if(await s.db.emailLog.create({data:{userId:e,emailType:t,activityId:r,sentTo:i,subject:n,status:c?"failed":"sent",error:c?JSON.stringify(c):null}}),c)return console.error("Failed to send email:",c),{success:!1,error:c.message};return{success:!0}}catch(a){console.error("Error sending email:",a);try{await s.db.emailLog.create({data:{userId:e,emailType:t,activityId:r,sentTo:i,subject:n,status:"failed",error:a.message}})}catch(e){console.error("Error logging failed email:",e)}return{success:!1,error:a.message}}}async function c(e,t){return await n(e.userId)?{success:!1,skipped:"Quiet hours"}:await o(e.userId,t)?await d(e):{success:!1,skipped:"Notification disabled by user"}}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30776:(e,t,r)=>{"use strict";r.d(t,{i:()=>s});var i=r(1678);async function s({action:e,entityType:t,entityId:r,userId:s,userEmail:a,changes:n}){return await i.db.auditLog.create({data:{action:e,entityType:t,entityId:r,userId:s,userEmail:a,changes:n?JSON.stringify(n):null}})}},41569:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.d(t,{A:()=>p});var s=r(37413),a=r(48965),n=r(96782),o=r(17660),d=r(44055),c=r(42913);r(61120);var l=r(71858),u=e([l]);function p({activityTitle:e,area:t,oldStatus:r,newStatus:i,changedBy:u,activityUrl:p}){let C=e=>{switch(e){case"Conclu\xeddo":return"#10b981";case"Em Andamento":return"#3b82f6";default:return"#64748b"}},U=e=>{switch(e){case"Conclu\xeddo":return"✅";case"Em Andamento":return"⏳";default:return"\uD83D\uDCCB"}},N=C(r),I=C(i);return(0,s.jsxs)(l.A,{preview:`Status atualizado: ${e}`,children:[(0,s.jsx)(a.D,{style:x,children:"\uD83D\uDCCA Status Atualizado"}),(0,s.jsxs)(n.E,{style:y,children:["O status da atividade ",(0,s.jsx)("strong",{children:e})," foi alterado por ",(0,s.jsx)("strong",{children:u}),"."]}),(0,s.jsx)(o.w,{style:f,children:(0,s.jsxs)("div",{style:h,children:[(0,s.jsxs)("div",{style:g,children:[(0,s.jsx)(n.E,{style:w,children:"Status Anterior"}),(0,s.jsxs)(n.E,{style:{...v,color:N},children:[U(r)," ",r]})]}),(0,s.jsx)("div",{style:m,children:(0,s.jsx)(n.E,{style:b,children:"→"})}),(0,s.jsxs)("div",{style:g,children:[(0,s.jsx)(n.E,{style:w,children:"Novo Status"}),(0,s.jsxs)(n.E,{style:{...v,color:I},children:[U(i)," ",i]})]})]})}),(0,s.jsxs)(o.w,{style:j,children:[(0,s.jsx)(n.E,{style:e,children:e}),(0,s.jsx)(d.Hr,{style:E}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)(n.E,{style:S,children:"\xc1rea:"}),(0,s.jsx)(n.E,{style:D,children:t})]})]}),"Conclu\xeddo"===i&&(0,s.jsx)(o.w,{style:q,children:(0,s.jsx)(n.E,{style:T,children:"\uD83C\uDF89 Parab\xe9ns por concluir esta atividade!"})}),(0,s.jsx)(o.w,{style:k,children:(0,s.jsx)(c.$,{style:R,href:p,children:"Ver Detalhes"})}),(0,s.jsx)(n.E,{style:z,children:"Continue acompanhando o progresso no dashboard."})]})}l=(u.then?(await u)():u)[0];let x={color:"#e2e8f0",fontSize:"28px",fontWeight:"bold",marginTop:"0",marginBottom:"16px"},y={color:"#cbd5e1",fontSize:"16px",lineHeight:"24px",marginBottom:"24px"},f={backgroundColor:"#1e293b",border:"2px solid #3b82f6",borderRadius:"8px",padding:"24px",marginBottom:"24px"},h={display:"flex",alignItems:"center",justifyContent:"space-between",gap:"16px"},g={flex:1,textAlign:"center"},m={flex:"0 0 auto"},b={color:"#60a5fa",fontSize:"32px",fontWeight:"bold",margin:"0"},w={color:"#94a3b8",fontSize:"12px",textTransform:"uppercase",marginBottom:"8px"},v={fontSize:"18px",fontWeight:"bold",margin:"0"},j={backgroundColor:"#0f172a",border:"1px solid #334155",borderRadius:"8px",padding:"24px",marginBottom:"24px"},E={borderColor:"#334155",margin:"16px 0"},A={marginBottom:"8px"},S={color:"#64748b",fontSize:"12px",textTransform:"uppercase",margin:"0 0 4px 0"},D={color:"#e2e8f0",fontSize:"14px",fontWeight:"500",margin:"0"},q={backgroundColor:"#064e3b",border:"2px solid #10b981",borderRadius:"8px",padding:"16px",textAlign:"center",marginBottom:"24px"},T={color:"#6ee7b7",fontSize:"16px",fontWeight:"bold",margin:"0"},k={textAlign:"center",marginTop:"32px",marginBottom:"24px"},R={backgroundColor:"#3b82f6",borderRadius:"6px",color:"#ffffff",fontSize:"16px",fontWeight:"bold",textDecoration:"none",textAlign:"center",display:"inline-block",padding:"12px 32px"},z={color:"#64748b",fontSize:"14px",lineHeight:"20px",textAlign:"center"};i()}catch(e){i(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71858:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.d(t,{A:()=>x});var s=r(37413),a=r(94768),n=r(16219),o=r(9367),d=r(3149),c=r(73808),l=r(17660),u=r(96782),p=r(2817);function x({preview:t,children:r}){return(0,s.jsxs)(a.E,{children:[(0,s.jsx)(n.p,{}),(0,s.jsx)(o.l,{children:t}),(0,s.jsx)(d.n,{style:e,children:(0,s.jsxs)(c.m,{style:y,children:[(0,s.jsx)(l.w,{style:f,children:(0,s.jsx)("div",{style:h,children:(0,s.jsx)("div",{style:g,children:(0,s.jsx)(u.E,{style:m,children:"\uD83D\uDEE1️ Defenz"})})})}),(0,s.jsx)(l.w,{style:b,children:r}),(0,s.jsxs)(l.w,{style:w,children:[(0,s.jsxs)(u.E,{style:v,children:["\xa9 ",new Date().getFullYear()," Defenz To-Do. All rights reserved."]}),(0,s.jsx)(u.E,{style:v,children:(0,s.jsx)(p.N,{href:`${process.env.NEXTAUTH_URL}/dashboard/settings/notifications`,style:j,children:"Manage notification preferences"})})]})]})})]})}r(61120);let e={backgroundColor:"#0f172a",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif'},y={backgroundColor:"#1e293b",margin:"0 auto",padding:"20px 0",marginBottom:"64px",maxWidth:"600px"},f={backgroundColor:"#0f172a",padding:"20px",borderBottom:"2px solid #3b82f6"},h={display:"flex",justifyContent:"center",alignItems:"center"},g={display:"inline-block"},m={fontSize:"28px",fontWeight:"bold",color:"#60a5fa",margin:"0"},b={padding:"32px"},w={backgroundColor:"#0f172a",padding:"20px",borderTop:"1px solid #334155",textAlign:"center"},v={color:"#94a3b8",fontSize:"12px",lineHeight:"20px",margin:"4px 0"},j={color:"#60a5fa",textDecoration:"underline"};i()}catch(e){i(e)}})},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83505:e=>{"use strict";e.exports=import("prettier/standalone")},84297:e=>{"use strict";e.exports=require("async_hooks")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[243,580,663,819,979],()=>r(12166));module.exports=i})();