(()=>{var e={};e.id=813,e.ids=[813],e.modules={1678:(e,r,t)=>{"use strict";t.d(r,{db:()=>s});let i=require("@prisma/client"),s=globalThis.prisma??new i.PrismaClient({log:["query"]})},2502:e=>{"use strict";e.exports=import("prettier/plugins/html")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5792:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GET:()=>d,POST:()=>d,authOptions:()=>l});var i=t(19854),s=t.n(i),a=t(13581),o=t(60890),n=t(1678),c=t(85663);let l={adapter:(0,o.y)(n.db),providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password required");let r=await n.db.user.findUnique({where:{email:e.email}});if(!r||!r.password||!await c.Ay.compare(e.password,r.password))throw Error("Invalid credentials");return{id:r.id,email:r.email,name:r.name,role:r.role}}})],session:{strategy:"jwt"},pages:{signIn:"/",error:"/"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e)},secret:process.env.NEXTAUTH_SECRET},d=s()(l)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11713:(e,r,t)=>{"use strict";t.a(e,async(e,i)=>{try{t.r(r),t.d(r,{GET:()=>d,POST:()=>u});var s=t(32190),a=t(1678),o=t(12909),n=t(21111),c=t(41288),l=e([c]);async function d(){try{let e=await a.db.activity.findMany({where:{deletedAt:null},orderBy:{createdAt:"desc"}});return s.NextResponse.json(e)}catch(e){return console.error("Error fetching activities:",e),s.NextResponse.json({error:"Failed to fetch activities"},{status:500})}}async function u(e){try{let r=await (0,o.HW)();if(!r)return s.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.json();if((await a.db.activity.findMany({where:{userId:r.id,deletedAt:null}})).some(e=>e.title.trim().toLowerCase()===t.title.trim().toLowerCase()&&e.area.trim().toLowerCase()===t.area.trim().toLowerCase()))return s.NextResponse.json({error:"Duplicate activity",message:`Atividade duplicada! J\xe1 existe uma atividade com o t\xedtulo "${t.title}" na \xe1rea "${t.area}"`},{status:409});let i=await a.db.activity.create({data:{title:t.title,area:t.area,priority:t.priority,status:t.status,description:t.description,responsible:t.responsible,deadline:t.deadline,location:t.location,how:t.how,cost:t.cost,userId:r.id}});return t.responsible&&r.email&&(0,n.kX)({userId:r.id,emailType:"assigned",activityId:i.id,to:r.email,subject:`Nova Atividade Atribu\xedda: ${i.title}`,react:(0,c.A)({activityTitle:i.title,activityDescription:i.description||void 0,area:i.area,priority:(e=>{switch(e){case 0:return"Alta";case 1:default:return"M\xe9dia";case 2:return"Baixa"}})(i.priority),deadline:i.deadline||void 0,location:i.location||void 0,assignedBy:r.name||r.email,activityUrl:`${process.env.NEXTAUTH_URL}/dashboard/activities`})},"activityAssigned").catch(e=>{console.error("Failed to send assignment email:",e)}),s.NextResponse.json(i)}catch(e){return console.error("Error creating activity:",e),s.NextResponse.json({error:"Failed to create activity"},{status:500})}}c=(l.then?(await l)():l)[0],i()}catch(e){i(e)}})},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,t)=>{"use strict";t.d(r,{HW:()=>o});var i=t(19854),s=t(5792);async function a(){return await (0,i.getServerSession)(s.authOptions)}async function o(){let e=await a();return e?.user}},21111:(e,r,t)=>{"use strict";t.d(r,{ZM:()=>c,kX:()=>l});var i=t(20549),s=t(1678);let a=process.env.RESEND_API_KEY?new i.u(process.env.RESEND_API_KEY):null;async function o(e){try{let r=await s.db.notificationPreferences.findUnique({where:{userId:e}});if(!r||!r.quietHoursStart||!r.quietHoursEnd)return!1;let t=new Date,i=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,a=r.quietHoursStart,o=r.quietHoursEnd;if(a>o)return i>=a||i<o;return i>=a&&i<o}catch(e){return console.error("Error checking quiet hours:",e),!1}}async function n(e,r){try{let t=await s.db.notificationPreferences.findUnique({where:{userId:e}});if(!t)return await s.db.notificationPreferences.create({data:{userId:e}}),!0;return t[r]}catch(e){return console.error("Error checking notification preferences:",e),!0}}async function c({userId:e,emailType:r,activityId:t,to:i,subject:o,react:n}){try{if(!a)return console.warn("RESEND_API_KEY not configured. Email sending disabled."),{success:!1,error:"Email service not configured"};let{data:c,error:l}=await a.emails.send({from:`${process.env.EMAIL_FROM_NAME||"Defenz To-Do"} <${process.env.EMAIL_FROM||"onboarding@resend.dev"}>`,to:[i],subject:o,react:n});if(await s.db.emailLog.create({data:{userId:e,emailType:r,activityId:t,sentTo:i,subject:o,status:l?"failed":"sent",error:l?JSON.stringify(l):null}}),l)return console.error("Failed to send email:",l),{success:!1,error:l.message};return{success:!0}}catch(a){console.error("Error sending email:",a);try{await s.db.emailLog.create({data:{userId:e,emailType:r,activityId:t,sentTo:i,subject:o,status:"failed",error:a.message}})}catch(e){console.error("Error logging failed email:",e)}return{success:!1,error:a.message}}}async function l(e,r){return await o(e.userId)?{success:!1,skipped:"Quiet hours"}:await n(e.userId,r)?await c(e):{success:!1,skipped:"Notification disabled by user"}}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41288:(e,r,t)=>{"use strict";t.a(e,async(e,i)=>{try{t.d(r,{A:()=>p});var s=t(37413),a=t(48965),o=t(96782),n=t(17660),c=t(44055),l=t(42913);t(61120);var d=t(71858),u=e([d]);function p({activityTitle:e,activityDescription:r,area:t,priority:i,deadline:u,location:p,assignedBy:q,activityUrl:S}){return(0,s.jsxs)(d.A,{preview:`Nova atividade atribu\xedda: ${e}`,children:[(0,s.jsx)(a.D,{style:x,children:"\uD83C\uDFAF Nova Atividade Atribu\xedda"}),(0,s.jsxs)(o.E,{style:y,children:["Ol\xe1! Voc\xea foi atribu\xeddo(a) a uma nova atividade por ",(0,s.jsx)("strong",{children:q}),"."]}),(0,s.jsxs)(n.w,{style:f,children:[(0,s.jsx)(o.E,{style:e,children:e}),r&&(0,s.jsx)(o.E,{style:h,children:r}),(0,s.jsx)(c.Hr,{style:g}),(0,s.jsxs)(n.w,{style:m,children:[(0,s.jsxs)("div",{style:v,children:[(0,s.jsx)(o.E,{style:b,children:"\xc1rea:"}),(0,s.jsx)(o.E,{style:w,children:t})]}),(0,s.jsxs)("div",{style:v,children:[(0,s.jsx)(o.E,{style:b,children:"Prioridade:"}),(0,s.jsx)(o.E,{style:{...w,color:"Alta"===i?"#ef4444":"M\xe9dia"===i?"#f59e0b":"#3b82f6",fontWeight:"bold"},children:i})]}),u&&(0,s.jsxs)("div",{style:v,children:[(0,s.jsx)(o.E,{style:b,children:"Prazo:"}),(0,s.jsx)(o.E,{style:w,children:u})]}),p&&(0,s.jsxs)("div",{style:v,children:[(0,s.jsx)(o.E,{style:b,children:"Local:"}),(0,s.jsx)(o.E,{style:w,children:p})]})]})]}),(0,s.jsx)(n.w,{style:j,children:(0,s.jsx)(l.$,{style:E,href:S,children:"Ver Atividade"})}),(0,s.jsx)(o.E,{style:A,children:"Acesse o dashboard para mais detalhes e atualiza\xe7\xf5es."})]})}d=(u.then?(await u)():u)[0];let x={color:"#e2e8f0",fontSize:"28px",fontWeight:"bold",marginTop:"0",marginBottom:"16px"},y={color:"#cbd5e1",fontSize:"16px",lineHeight:"24px",marginBottom:"24px"},f={backgroundColor:"#0f172a",border:"1px solid #334155",borderRadius:"8px",padding:"24px",marginBottom:"24px"},h={color:"#94a3b8",fontSize:"14px",lineHeight:"20px",marginBottom:"16px"},g={borderColor:"#334155",margin:"16px 0"},m={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},v={marginBottom:"8px"},b={color:"#64748b",fontSize:"12px",textTransform:"uppercase",margin:"0 0 4px 0"},w={color:"#e2e8f0",fontSize:"14px",fontWeight:"500",margin:"0"},j={textAlign:"center",marginTop:"32px",marginBottom:"24px"},E={backgroundColor:"#3b82f6",borderRadius:"6px",color:"#ffffff",fontSize:"16px",fontWeight:"bold",textDecoration:"none",textAlign:"center",display:"inline-block",padding:"12px 32px"},A={color:"#64748b",fontSize:"14px",lineHeight:"20px",textAlign:"center"};i()}catch(e){i(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},54820:(e,r,t)=>{"use strict";t.a(e,async(e,i)=>{try{t.r(r),t.d(r,{patchFetch:()=>l,routeModule:()=>d,serverHooks:()=>x,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>p});var s=t(96559),a=t(48088),o=t(37719),n=t(11713),c=e([n]);n=(c.then?(await c)():c)[0];let d=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/activities/route",pathname:"/api/activities",filename:"route",bundlePath:"app/api/activities/route"},resolvedPagePath:"/Users/marcoscruz/Documents/Projetos/Defenz/Defenz - To-Do/src/app/api/activities/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:u,workUnitAsyncStorage:p,serverHooks:x}=d;function l(){return(0,o.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:p})}i()}catch(e){i(e)}})},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71858:(e,r,t)=>{"use strict";t.a(e,async(e,i)=>{try{t.d(r,{A:()=>x});var s=t(37413),a=t(94768),o=t(16219),n=t(9367),c=t(3149),l=t(73808),d=t(17660),u=t(96782),p=t(2817);function x({preview:r,children:t}){return(0,s.jsxs)(a.E,{children:[(0,s.jsx)(o.p,{}),(0,s.jsx)(n.l,{children:r}),(0,s.jsx)(c.n,{style:e,children:(0,s.jsxs)(l.m,{style:y,children:[(0,s.jsx)(d.w,{style:f,children:(0,s.jsx)("div",{style:h,children:(0,s.jsx)("div",{style:g,children:(0,s.jsx)(u.E,{style:m,children:"\uD83D\uDEE1Ô∏è Defenz"})})})}),(0,s.jsx)(d.w,{style:v,children:t}),(0,s.jsxs)(d.w,{style:b,children:[(0,s.jsxs)(u.E,{style:w,children:["\xa9 ",new Date().getFullYear()," Defenz To-Do. All rights reserved."]}),(0,s.jsx)(u.E,{style:w,children:(0,s.jsx)(p.N,{href:`${process.env.NEXTAUTH_URL}/dashboard/settings/notifications`,style:j,children:"Manage notification preferences"})})]})]})})]})}t(61120);let e={backgroundColor:"#0f172a",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif'},y={backgroundColor:"#1e293b",margin:"0 auto",padding:"20px 0",marginBottom:"64px",maxWidth:"600px"},f={backgroundColor:"#0f172a",padding:"20px",borderBottom:"2px solid #3b82f6"},h={display:"flex",justifyContent:"center",alignItems:"center"},g={display:"inline-block"},m={fontSize:"28px",fontWeight:"bold",color:"#60a5fa",margin:"0"},v={padding:"32px"},b={backgroundColor:"#0f172a",padding:"20px",borderTop:"1px solid #334155",textAlign:"center"},w={color:"#94a3b8",fontSize:"12px",lineHeight:"20px",margin:"4px 0"},j={color:"#60a5fa",textDecoration:"underline"};i()}catch(e){i(e)}})},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83505:e=>{"use strict";e.exports=import("prettier/standalone")},84297:e=>{"use strict";e.exports=require("async_hooks")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[243,580,663,819,979],()=>t(54820));module.exports=i})();