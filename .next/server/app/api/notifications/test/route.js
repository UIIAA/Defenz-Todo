(()=>{var e={};e.id=237,e.ids=[237],e.modules={1678:(e,r,t)=>{"use strict";t.d(r,{db:()=>i});let s=require("@prisma/client"),i=globalThis.prisma??new s.PrismaClient({log:["query"]})},2502:e=>{"use strict";e.exports=import("prettier/plugins/html")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5792:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GET:()=>d,POST:()=>d,authOptions:()=>l});var s=t(19854),i=t.n(s),a=t(13581),n=t(60890),o=t(1678),c=t(85663);let l={adapter:(0,n.y)(o.db),providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Email and password required");let r=await o.db.user.findUnique({where:{email:e.email}});if(!r||!r.password||!await c.Ay.compare(e.password,r.password))throw Error("Invalid credentials");return{id:r.id,email:r.email,name:r.name,role:r.role}}})],session:{strategy:"jwt"},pages:{signIn:"/",error:"/"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.role=r.role),e)},secret:process.env.NEXTAUTH_SECRET},d=i()(l)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},12909:(e,r,t)=>{"use strict";t.d(r,{HW:()=>n});var s=t(19854),i=t(5792);async function a(){return await (0,s.getServerSession)(i.authOptions)}async function n(){let e=await a();return e?.user}},21111:(e,r,t)=>{"use strict";t.d(r,{ZM:()=>c,kX:()=>l});var s=t(20549),i=t(1678);let a=process.env.RESEND_API_KEY?new s.u(process.env.RESEND_API_KEY):null;async function n(e){try{let r=await i.db.notificationPreferences.findUnique({where:{userId:e}});if(!r||!r.quietHoursStart||!r.quietHoursEnd)return!1;let t=new Date,s=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`,a=r.quietHoursStart,n=r.quietHoursEnd;if(a>n)return s>=a||s<n;return s>=a&&s<n}catch(e){return console.error("Error checking quiet hours:",e),!1}}async function o(e,r){try{let t=await i.db.notificationPreferences.findUnique({where:{userId:e}});if(!t)return await i.db.notificationPreferences.create({data:{userId:e}}),!0;return t[r]}catch(e){return console.error("Error checking notification preferences:",e),!0}}async function c({userId:e,emailType:r,activityId:t,to:s,subject:n,react:o}){try{if(!a)return console.warn("RESEND_API_KEY not configured. Email sending disabled."),{success:!1,error:"Email service not configured"};let{data:c,error:l}=await a.emails.send({from:`${process.env.EMAIL_FROM_NAME||"Defenz To-Do"} <${process.env.EMAIL_FROM||"onboarding@resend.dev"}>`,to:[s],subject:n,react:o});if(await i.db.emailLog.create({data:{userId:e,emailType:r,activityId:t,sentTo:s,subject:n,status:l?"failed":"sent",error:l?JSON.stringify(l):null}}),l)return console.error("Failed to send email:",l),{success:!1,error:l.message};return{success:!0}}catch(a){console.error("Error sending email:",a);try{await i.db.emailLog.create({data:{userId:e,emailType:r,activityId:t,sentTo:s,subject:n,status:"failed",error:a.message}})}catch(e){console.error("Error logging failed email:",e)}return{success:!1,error:a.message}}}async function l(e,r){return await n(e.userId)?{success:!1,skipped:"Quiet hours"}:await o(e.userId,r)?await c(e):{success:!1,skipped:"Notification disabled by user"}}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},37948:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{patchFetch:()=>l,routeModule:()=>d,serverHooks:()=>x,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>p});var i=t(96559),a=t(48088),n=t(37719),o=t(68045),c=e([o]);o=(c.then?(await c)():c)[0];let d=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/notifications/test/route",pathname:"/api/notifications/test",filename:"route",bundlePath:"app/api/notifications/test/route"},resolvedPagePath:"/Users/marcoscruz/Documents/Projetos/Defenz/Defenz - To-Do/src/app/api/notifications/test/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:u,workUnitAsyncStorage:p,serverHooks:x}=d;function l(){return(0,n.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:p})}s()}catch(e){s(e)}})},41288:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{A:()=>p});var i=t(37413),a=t(48965),n=t(96782),o=t(17660),c=t(44055),l=t(42913);t(61120);var d=t(71858),u=e([d]);function p({activityTitle:e,activityDescription:r,area:t,priority:s,deadline:u,location:p,assignedBy:S,activityUrl:q}){return(0,i.jsxs)(d.A,{preview:`Nova atividade atribu\xedda: ${e}`,children:[(0,i.jsx)(a.D,{style:x,children:"\uD83C\uDFAF Nova Atividade Atribu\xedda"}),(0,i.jsxs)(n.E,{style:f,children:["Ol\xe1! Voc\xea foi atribu\xeddo(a) a uma nova atividade por ",(0,i.jsx)("strong",{children:S}),"."]}),(0,i.jsxs)(o.w,{style:m,children:[(0,i.jsx)(n.E,{style:e,children:e}),r&&(0,i.jsx)(n.E,{style:g,children:r}),(0,i.jsx)(c.Hr,{style:h}),(0,i.jsxs)(o.w,{style:y,children:[(0,i.jsxs)("div",{style:E,children:[(0,i.jsx)(n.E,{style:b,children:"\xc1rea:"}),(0,i.jsx)(n.E,{style:v,children:t})]}),(0,i.jsxs)("div",{style:E,children:[(0,i.jsx)(n.E,{style:b,children:"Prioridade:"}),(0,i.jsx)(n.E,{style:{...v,color:"Alta"===s?"#ef4444":"M\xe9dia"===s?"#f59e0b":"#3b82f6",fontWeight:"bold"},children:s})]}),u&&(0,i.jsxs)("div",{style:E,children:[(0,i.jsx)(n.E,{style:b,children:"Prazo:"}),(0,i.jsx)(n.E,{style:v,children:u})]}),p&&(0,i.jsxs)("div",{style:E,children:[(0,i.jsx)(n.E,{style:b,children:"Local:"}),(0,i.jsx)(n.E,{style:v,children:p})]})]})]}),(0,i.jsx)(o.w,{style:j,children:(0,i.jsx)(l.$,{style:w,href:q,children:"Ver Atividade"})}),(0,i.jsx)(n.E,{style:A,children:"Acesse o dashboard para mais detalhes e atualiza\xe7\xf5es."})]})}d=(u.then?(await u)():u)[0];let x={color:"#e2e8f0",fontSize:"28px",fontWeight:"bold",marginTop:"0",marginBottom:"16px"},f={color:"#cbd5e1",fontSize:"16px",lineHeight:"24px",marginBottom:"24px"},m={backgroundColor:"#0f172a",border:"1px solid #334155",borderRadius:"8px",padding:"24px",marginBottom:"24px"},g={color:"#94a3b8",fontSize:"14px",lineHeight:"20px",marginBottom:"16px"},h={borderColor:"#334155",margin:"16px 0"},y={display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},E={marginBottom:"8px"},b={color:"#64748b",fontSize:"12px",textTransform:"uppercase",margin:"0 0 4px 0"},v={color:"#e2e8f0",fontSize:"14px",fontWeight:"500",margin:"0"},j={textAlign:"center",marginTop:"32px",marginBottom:"24px"},w={backgroundColor:"#3b82f6",borderRadius:"6px",color:"#ffffff",fontSize:"16px",fontWeight:"bold",textDecoration:"none",textAlign:"center",display:"inline-block",padding:"12px 32px"},A={color:"#64748b",fontSize:"14px",lineHeight:"20px",textAlign:"center"};s()}catch(e){s(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68045:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{POST:()=>l});var i=t(32190),a=t(12909),n=t(21111),o=t(41288),c=e([o]);async function l(e){try{let e=await (0,a.HW)();if(!e)return i.NextResponse.json({error:"Unauthorized"},{status:401});if(!e.email)return i.NextResponse.json({error:"User email not found"},{status:400});if(!process.env.RESEND_API_KEY)return i.NextResponse.json({error:"Email service not configured. Please set RESEND_API_KEY environment variable."},{status:503});let r=await (0,n.ZM)({userId:e.id,emailType:"assigned",to:e.email,subject:"Teste de Notifica\xe7\xe3o - Defenz To-Do",react:(0,o.A)({activityTitle:"Teste de Notifica\xe7\xe3o por Email",activityDescription:"Este \xe9 um email de teste para verificar se as notifica\xe7\xf5es est\xe3o funcionando corretamente.",area:"Sistema",priority:"M\xe9dia",deadline:new Date().toLocaleDateString("pt-BR"),location:"Dashboard",assignedBy:e.name||e.email,activityUrl:`${process.env.NEXTAUTH_URL}/dashboard/activities`})});if(r.success)return i.NextResponse.json({success:!0,message:`Email de teste enviado com sucesso para ${e.email}`});return i.NextResponse.json({success:!1,error:r.error||"Falha ao enviar email de teste"},{status:500})}catch(e){return console.error("Error sending test email:",e),i.NextResponse.json({error:"Failed to send test email",details:e.message},{status:500})}}o=(c.then?(await c)():c)[0],s()}catch(e){s(e)}})},71858:(e,r,t)=>{"use strict";t.a(e,async(e,s)=>{try{t.d(r,{A:()=>x});var i=t(37413),a=t(94768),n=t(16219),o=t(9367),c=t(3149),l=t(73808),d=t(17660),u=t(96782),p=t(2817);function x({preview:r,children:t}){return(0,i.jsxs)(a.E,{children:[(0,i.jsx)(n.p,{}),(0,i.jsx)(o.l,{children:r}),(0,i.jsx)(c.n,{style:e,children:(0,i.jsxs)(l.m,{style:f,children:[(0,i.jsx)(d.w,{style:m,children:(0,i.jsx)("div",{style:g,children:(0,i.jsx)("div",{style:h,children:(0,i.jsx)(u.E,{style:y,children:"\uD83D\uDEE1ï¸ Defenz"})})})}),(0,i.jsx)(d.w,{style:E,children:t}),(0,i.jsxs)(d.w,{style:b,children:[(0,i.jsxs)(u.E,{style:v,children:["\xa9 ",new Date().getFullYear()," Defenz To-Do. All rights reserved."]}),(0,i.jsx)(u.E,{style:v,children:(0,i.jsx)(p.N,{href:`${process.env.NEXTAUTH_URL}/dashboard/settings/notifications`,style:j,children:"Manage notification preferences"})})]})]})})]})}t(61120);let e={backgroundColor:"#0f172a",fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif'},f={backgroundColor:"#1e293b",margin:"0 auto",padding:"20px 0",marginBottom:"64px",maxWidth:"600px"},m={backgroundColor:"#0f172a",padding:"20px",borderBottom:"2px solid #3b82f6"},g={display:"flex",justifyContent:"center",alignItems:"center"},h={display:"inline-block"},y={fontSize:"28px",fontWeight:"bold",color:"#60a5fa",margin:"0"},E={padding:"32px"},b={backgroundColor:"#0f172a",padding:"20px",borderTop:"1px solid #334155",textAlign:"center"},v={color:"#94a3b8",fontSize:"12px",lineHeight:"20px",margin:"4px 0"},j={color:"#60a5fa",textDecoration:"underline"};s()}catch(e){s(e)}})},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83505:e=>{"use strict";e.exports=import("prettier/standalone")},84297:e=>{"use strict";e.exports=require("async_hooks")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[243,580,663,819,979],()=>t(37948));module.exports=s})();